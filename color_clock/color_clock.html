<!DOCTYPE>
<html>
<head>
    <title>color clock concept</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="./color_clock.css">
    <link href="https://fonts.googleapis.com/css?family=Space+Mono" rel="stylesheet">
</head>

<body>

    <script src="https://d3js.org/d3.v4.min.js"></script>
    
    <div id="bg"></div>
    
    <div id="container">
        <div id="clock">
            <div id="h">00</div>
            :
            <div id="m">00</div>
            :
            <div id="s">00</div>
        </div>
        
        <div id="date">
            <div id="W">MON</div>
            <div class="invis">_</div>
            <div id="D">00</div>
            <div class="invis">_</div>
            <div id="M">JAN</div>
            <div class="invis">_</div>
            <div id="Y" >0000</div>
        </div>
    </div>
    
    <div id="gradient"></div>
    
    <script>
        
        function hslToHex(h, s, l) {
            let r, g, b
            if (s === 0) {
                r = g = b = l // achromatic
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1
                    if (t > 1) t -= 1
                    if (t < 1 / 6) return p + (q - p) * 6 * t
                    if (t < 1 / 2) return q
                    if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6
                    return p
                }
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s
                const p = 2 * l - q
                r = hue2rgb(p, q, h + 1 / 3)
                g = hue2rgb(p, q, h)
                b = hue2rgb(p, q, h - 1 / 3)
            }
            const toHex = x => {
                const hex = Math.round(x * 255).toString(16);
                return hex.length === 1 ? '0' + hex : hex
            }
            return `#${toHex(r)}${toHex(g)}${toHex(b)}`
        }
        
        function start() {
            let d = new Date()
            
            utime(d, true)
            
            update()
        }
        
        function update() {
            let d = new Date()
            
            utime(d, false)
            
            setTimeout(update, 1000)
        }
        
        function utime(d, init) {
            
            if (init) udate(d, true)
            
            s = d.getSeconds()
            document.getElementById("s").innerHTML = s / 10 < 1 ? "0"+s : s
            
            if (s == 0 || init) {
                m = d.getMinutes()
                document.getElementById("m").innerHTML = m / 10 < 1 ? "0"+m : m
                
                if (m == 0 || init) {
                    h = d.getHours()
                    document.getElementById("h").innerHTML = h / 10 < 1 ? "0"+h : h
                    
                    if (h == 0) udate(d, false)
                }
            }
            
            ucol(h, m, s)
            
        }
        
        function scalarToRad(a) {
            return a * Math.PI * 2
        }
        
        function ucol(h, m, s) {
            
// --------------------------------- COLOR ---------------------------------
            
            const HUELOOP = 'h'
            
            let hue
            
            if (HUELOOP == 'd') {
                // 24h loop
                hue = h*3600 + m*60 + s
                hue /= 24*3600
            } else if (HUELOOP == 'h') {
                // 1h loop
                hue = m*60 + s
                hue /= 3600
            } else if (HUELOOP == 'm') {
                // 1m loop
                hue = s
                hue /= 60
            } else hue = 0
            
// ------------------------------- BRIGHTNESS ------------------------------
            
            const BRIGHTLOOP = 'd'
            
            let lightness
            let lightness_txt
            
            if (BRIGHTLOOP == 'd') {
                // day / night
                const deviation = 0.1
                const base = 0.2
                let tmp_time = (h*3600 + m*60 + s) / (24*3600)
                let tmp_light = 1 - Math.cos(scalarToRad(tmp_time))
                lightness = base - deviation + tmp_light * deviation
                lightness_txt = lightness + (1-base)/2
            } else if (BRIGHTLOOP == 'm') {
                // 1m loop
                const deviation = 0.1
                const base = 0.2
                let tmp_time = s / 60
                let tmp_light = 1 - Math.cos(scalarToRad(tmp_time))
                lightness = base - deviation + tmp_light * deviation
                lightness_txt = lightness + (1-base)/2
            } else {
                // static
                lightness = 0.2
                lightness_txt = 0.5
            }
            
            document.getElementById("bg").style.backgroundColor = hslToHex(hue, 1, lightness)
            
            document.getElementById("container").style.color = hslToHex(hue, 1, lightness_txt)
            
        }
        
        const wdays = ["MON", "TUE", "WED", "THU", "FRI", "SAT", "SUN"]
        const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"]
        
        function udate(d, init) {
            
            D = d.getDate()
            
            document.getElementById("W").innerHTML = wdays[d.getDay()-1]
            document.getElementById("D").innerHTML = D / 10 < 1 ? "0"+D : D
            
            if (D == 0 || init) {
                let M = d.getMonth()
                document.getElementById("M").innerHTML = months[M]
                
                if (m == 0 || init) {
                    document.getElementById("Y").innerHTML = d.getFullYear()
                }
            }
        }
        
        start()
                
        window.addEventListener('keypress', e => {
            if (e.keyCode == 32) start()
        })
    </script>
    
</body>
</html>
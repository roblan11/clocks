<!DOCTYPE>
<html>
<head>
    <title>color clock concept</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="./color_clock.css">
    <link href="https://fonts.googleapis.com/css?family=Space+Mono" rel="stylesheet">
</head>

<body>

    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="../noSleep/NoSleep.js"></script>
    
    <div id="bg"></div>
    
    <div id="container">
        <div id="clock">
            <div id="h">00</div>
            :
            <div id="m">00</div>
            :
            <div id="s">00</div>
        </div>
        
        <div id="date">
            <div id="W">MON</div>
            <div class="invis">_</div>
            <div id="D">00</div>
            <div class="invis">_</div>
            <div id="M">JAN</div>
            <div class="invis">_</div>
            <div id="Y" >0000</div>
        </div>
    </div>
    
    <div id="gradient"></div>
    
    <script>
        let noSleep = new NoSleep();
        
        function start() {
            noSleep.enable();
            
            let d = new Date()
            
            utime(d, true)
            
            update()
        }
        
        function update() {
            let d = new Date()
            
            utime(d, false)
            
            setTimeout(update, 1000)
        }
        
        function utime(d, init) {
            
            if (init) udate(d, true)
            
            s = d.getSeconds()
            document.getElementById("s").innerHTML = s / 10 < 1 ? "0"+s : s
            
            if (s == 0 || init) {
                m = d.getMinutes()
                document.getElementById("m").innerHTML = m / 10 < 1 ? "0"+m : m
                
                if (m == 0 || init) {
                    h = d.getHours()
                    document.getElementById("h").innerHTML = h / 10 < 1 ? "0"+h : h
                    
                    if (h == 0) udate(d, false)
                }
            }
            
            ucol(h, m, s)
            
        }
        
        function scalarToRad(a) {
            return a * Math.PI * 2
        }
        
        function ucol(h, m, s) {
            
// --------------------------------- COLOR ---------------------------------
            
            const HUELOOP = 'h'
            
            let hue
            
            if (HUELOOP == 'd') {
                // 24h loop
                hue = (h*3600 + m*60 + s)/240
            } else if (HUELOOP == 'h') {
                // 1h loop
                hue = (m*60 + s)/10
            } else if (HUELOOP == 'm') {
                // 1m loop
                hue = s*6
            } else hue = 0
            
// ------------------------------- BRIGHTNESS ------------------------------
            
            const BRIGHTLOOP = 'd'
            
            let lightness
            let lightness_txt
            
            if (BRIGHTLOOP == 'd') {
                // day / night
                const deviation = 10
                const base = 20
                
                let tmp_time = (h*3600 + m*60 + s) / (24*3600)
                let tmp_light = 1 - Math.cos(scalarToRad(tmp_time))
                
                lightness = base - deviation + tmp_light * deviation
                lightness_txt = lightness + (100-base)/2
            } else if (BRIGHTLOOP == 'm') {
                // 1m loop
                const deviation = 10
                const base = 20
                
                let tmp_time = s / 60
                let tmp_light = 1 - Math.cos(scalarToRad(tmp_time))
                
                lightness = base - deviation + tmp_light * deviation
                lightness_txt = lightness + (100-base)/2
            } else {
                // static
                lightness = 20
                lightness_txt = 50
            }
            
            document.getElementById("bg").style.backgroundColor = `hsl(${hue}, 100%, ${lightness}%)`
            
            document.getElementById("container").style.color = `hsl(${hue}, 100%, ${lightness_txt}%)`
            
        }
        
        const wdays = ["SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"]
        const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"]
        
        function udate(d, init) {
            
            D = d.getDate()
            
            document.getElementById("W").innerHTML = wdays[d.getDay()]
            document.getElementById("D").innerHTML = D / 10 < 1 ? "0"+D : D
            
            if (D == 0 || init) {
                let M = d.getMonth()
                document.getElementById("M").innerHTML = months[M]
                
                if (m == 0 || init) {
                    document.getElementById("Y").innerHTML = d.getFullYear()
                }
            }
        }
        
        start()
                
        window.addEventListener('keypress', e => {
            if (e.keyCode == 32) start()
        })
    </script>
    
</body>
</html>